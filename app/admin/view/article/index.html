{extend name="public/base" /}
{block name="main"}
<!-- Page Body -->

<div class="page-body">

    <div class="row">
        <div class="col-lg-12 col-sm-12 col-xs-12">
            <div class="widget">
                <div class="widget-body">
                    <div class="col-md-3">
                        <input type="text" name="article_key" class="form-control" placeholder="Search">
                    </div>
                    <div class="flip-scroll">
                        <form action="" method="post" id="form">
                            <input class="btn btn-sm btn-primary article_search" searchurl="{:url('article/index')}" value="搜索" type="button">

                            <?php if(authCheck('article/add')):?>
                            <a href="#" id="add" addurl="{:url('article/add')}" title="添加文章" class="btn btn-sm btn-azure btn-addon"> <i class="fa fa-plus"></i> Add</a>
                            <?php endif;?>

                            <?php if(authCheck('article/dels')):?>
                            <input form="form" formaction="{:url('article/dels')}" onclick="return confirm('确定要删除吗？')" id="deletes" type="submit" class="btn btn-sm btn-danger"value="批量删除">
                            <?php endif;?>
                            <!-- input class="btn btn-primary btn-sm" url="{:url('article/index')}" type="button" id="shiny" value="排序"> -->
                            <input class="btn btn-sm btn-danger" value="清空" onclick="window.location.reload()" type="button">
                            <br><br>
                            <table class="table table-bordered table-hover">
                                <thead class="">
                                <tr id="thead">
                                    <th class="text-center">
                                        <label>
                                            <input type="checkbox" class="inverted" >
                                            <span class="text" style="cursor: pointer" id="fck"></span>
                                        </label>
                                    </th>
                                    <th class="text-center" width="2%">ID</th>
                                    <!-- <th class="text-center" width="3%">排序</th> -->
                                    <th class="text-center">名称</th>
                                    <th class="text-center">副标题</th>
                                    <th class="text-center">所属栏目</th>
                                    <th class="text-center">图片</th>
                                    <!--<th class="text-center">内容</th>-->
                                    <th class="text-center" width="15%">操作</th>
                                </tr>
                                </thead>
                                <tbody>
                                {volist name="res" id="vo"}
                                <tr id="tr_{$vo.id}">
                                    <td class="text-center" >
                                        <label>
                                            <input type="checkbox" name="id[]" value="{$vo.id}" class="inverted sck">
                                            <span class="text" style="cursor: pointer"></span>
                                        </label>
                                    </td>
                                    <td align="center">{$vo.id}</td>
                           <!--          <td align="center"><input name="{$vo.id}" class="sort" type="text" style="width:50px; text-align:center;" value="{$vo.sort}"></td> -->
                                    <td>
                                        {if condition="$vo.rec eq 1"}
                                        <a href="{:url('index/article/index',array('cid'=>$vo.cid,'id'=>$vo.id))}" style="color:green">{$vo.title}<span class="label label-darkorange">推荐</span></a>
                                        {else/}
                                        <a href="{:url('index/article/index',array('cid'=>$vo.cid,'id'=>$vo.id))}" style="color:green">{$vo.title}</a>
                                        {/if}

                                    </td>
                                    <td class="sub sub_{$vo.id}" data-id="{$vo.id}" data-title="{$vo.unlimit_desc}">{$vo.desc}</td>
                                    <td align="center">
                                        {$vo.catename}
                                    </td>
                                    <td align="center" class="layer_view">
                                        <img style="cursor: pointer" src="{$vo.pic}" name="src" height="50" title="{$vo.desc}">
                                    </td>
                             <!--       <td align="center" class="content">
                                        {$vo.content|urldecode|mb_substr=0,1,'utf-8'}
                                    </td>-->
                                    <td align="center">
                                        <?php if(authCheck('article/edit')):?>
                                        <a href="javascript:void(0)" title="修改" class="btn btn-info btn-xs edit update" updateurl="{:url('article/edit',array('id'=>$vo['id']))}"><i class="fa fa-edit"></i> Edit</a>
                                        <?php endif;?>

                                        <?php if(authCheck('article/delete')):?>
                                        <a href="javascript:void(0)" title="删除" class="btn btn-danger btn-xs delete" deleteurl="{:url('article/delete',array('id'=>$vo['id']))}"><i class="fa fa-trash-o"></i> Delete</a>
                                        <?php endif;?>

                                        <?php if(authCheck('article/status')):?>
                                        {if condition="$vo.rec eq 1"}
                                        <a href="javascript:void(0)" title="取消" class="btn btn-maroon btn-xs fabu" fabuurl="{:url('article/status',array('id'=>$vo['id'],'rec'=>0))}"><i class="fa fa-level-down"></i>取消</a>
                                        {else/}
                                        <a href="javascript:void(0)" title="推荐" class="btn btn-azure btn-xs fabu" fabuurl="{:url('article/status',array('id'=>$vo['id'],'rec'=>1))}"><i class="fa fa-level-up"></i>推荐</a>
                                        {/if}
                                        <?php endif;?>

                                    </td>
                                </tr>
                                {/volist}
                                </tbody>
                            </table>
                        </form>
                    </div>
                    <div style="padding-top:10px;">
                        {$res->render()}
                    </div>

                </div>
            </div>
        </div>
    </div>

</div>
<!-- /Page Body -->
{/block}
{block name="page_script"}
<script>
    $(".sub").hover(function() {
        let id=$(this).data('id');
        let title = $(this).data('title');
        if(title){
            openMsg(".sub_"+id,title);
        }
    }, function() {
        layer.close(subtips);
    });
    function openMsg($e,$title) {
        subtips = layer.tips($title, $e,{tips:[1,'#57b5e3'],time: 30000});
    }

    let article_search = $(".article_search");
    let url = "{:url('article/index')}";
    $(article_search).click(function(){
        let key = $("input[name=article_key]").val();
        if(key){
            $.ajax({
                data:{"key":key},
                url: url,
                dataType:'json',
                success:function(res){
                    console.log(res);
                }
            });
        }
    });
</script>
{/block}

